webpackJsonp([14],{"7p6X":function(e,t,r){(e.exports=r("FZ+f")(!1)).push([e.i,"\n.timeBox {\n  position: relative;\n  width: 630px;\n}\n.time_s {\n  position: absolute;\n  right: 0;\n  top: 10px;\n}\n",""])},B411:function(e,t,r){var a=r("7p6X");"string"==typeof a&&(a=[[e.i,a,""]]),a.locals&&(e.exports=a.locals);r("rjj0")("c602392e",a,!0)},"E9/A":function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=r("woOf"),s=r.n(a),l=r("gyMJ"),i={id:"",name:"",effectStartTime:"",effectEndTime:"",dynamic:!1,actDaysLimit:"",validDaysLimit:"",maxNum:"",limitNum:"",obtained:0,obtainStartTime:"",obtainEndTime:"",conAmount:"",type:1,amount:"",discount:"",userLevelType:1,userGradeList:[],userTagsList:[],reused:!1,phoneLimited:!1,firstOrderType:0,firstOrderLimited:!1,firstDeviceLimited:!1,channelList:[],reportType:0,couponDepartment:"",remark:"",info:"",prefix:"",isStart:!1,reportStartTime:"",reportEndTime:""},o={data:function(){return{ruleForm:s()({},i),userGradeList:[],userTagsList:[],channels:[],status:0,umpPlatCouponId:0,rules:{name:[{required:!0,message:"优惠券名称不能为空，最多可输入30个字符，不能输入特殊符号",trigger:["blur","change"]},{min:1,max:25,message:"长度在 1 到 30 个字符",trigger:["blur","change"]}],effectStartTime:[{required:!0,message:"请选择活动时间",trigger:["blur","change"]}],actDaysLimit:[{required:!0,message:"不能为空",trigger:["blur","change"]}],validDaysLimit:[{required:!0,message:"不能为空",trigger:["blur","change"]}],maxNum:[{required:!0,message:"请填写发行数",trigger:["blur","change"]},{type:"number",message:"发行数必须为数字值",trigger:["blur","change"]}],limitNum:[{required:!0,message:"请填写用户最多拥有数量",trigger:["blur","change"]},{type:"number",message:"必须为数字值",trigger:["blur","change"]}],obtainStartTime:[{required:!0,message:"请填写领取时间",trigger:["blur","change"]}],conAmount:[{required:!0,message:"请填写使用条件",trigger:["blur","change"]}],amount:[{required:!0,message:"请填写订单价格优惠",trigger:["blur","change"]},{type:"number",message:"必须为数字值",trigger:["blur","change"]}],discount:[{required:!0,message:"请填写优惠折扣",trigger:["blur","change"]},{type:"number",message:"必须为数字值",trigger:["blur","change"]}],userGradeList:[{required:!0,message:"请选择会员等级",trigger:["blur","change"]}],userTagsList:[{required:!0,message:"请选择会员标签",trigger:["blur","change"]}],reused:[{required:!0,message:"请选择优惠券类型",trigger:["blur","change"]}],phoneLimited:[{required:!0,message:"请选择限制手机用户使用",trigger:["blur","change"]}],firstOrderType:[{required:!0,message:"请选择限制用户首单使用",trigger:["blur","change"]}],firstDeviceLimited:[{required:!0,message:"请选择限制设备首单使用",trigger:["blur","change"]}],reportType:[{required:!0,message:"请选择提报类型",trigger:["blur","change"]}]}}},components:{},computed:{},activated:function(){this.resetForm("ruleForm"),this.activityId=this.$route.params.activityId||0,this.umpPlatCouponId=this.$route.params.umpPlatCouponId||0,this.status=this.$route.params.status||0,this.inits(this.umpPlatCouponId),console.log(this.activityId),console.log(this.umpPlatCouponId),this.getMemberLevels(),this.getMemberTags(),this.getChannels()},deactivated:function(){this.resetForm("ruleForm")},methods:{inits:function(e){var t=this;this.umpPlatCouponId=e||0,e?l.a.activity.fullCoupon(this.activityId).then(function(e){var r=e.data;if(r&&0===r.code){console.log(r);var a=r.data;t.ruleForm=s()({},a),t.ruleForm.effectStartTime=[a.effectStartTime,a.effectStartTime],t.ruleForm.obtainStartTime=[a.obtainStartTime,a.obtainEndTime],t.ruleForm.conAmount=a.conAmount/100,t.ruleForm.amount=a.amount/100,console.log(t.ruleForm)}}).catch(function(){}):this.ruleForm=s()({},i)},submitForm:function(e){var t=this;this.$refs[e].validate(function(e){if(!e)return!1;console.log("dd"),console.log(t.ruleForm);var r=s()({},t.ruleForm);r.effectStartTime=t.ruleForm.effectStartTime[0],r.effectEndTime=t.ruleForm.effectStartTime[1],r.obtainStartTime=t.ruleForm.obtainStartTime[0],r.obtainEndTime=t.ruleForm.obtainEndTime[1],r.activityId=t.activityId,r.conAmount=100*t.ruleForm.conAmount,r.amount=100*t.ruleForm.amount,console.log(r),t.$nextTick(function(){(t.ruleForm.id?l.a.activity.updateCoupon(r):l.a.activity.addCoupon(r)).then(function(e){var r=e.data;r&&0===r.code?t.$alert("添加成功","提示",{confirmButtonText:"确定",type:"success",showClose:!1,callback:function(e){t.$router.push({name:"activity"})}}):t.$alert(r.msg,"提示",{confirmButtonText:"确定",type:"warning",showClose:!1})}).catch(function(){})})})},resetForm:function(e){this.$refs[e].resetFields()},getMemberLevels:function(){var e=this;l.a.activity.memberLevels().then(function(t){var r=t.data;r&&0===r.code&&(e.userGradeList=r.memberLevels)}).catch(function(){})},getMemberTags:function(){var e=this;l.a.activity.memberTags().then(function(t){var r=t.data;r&&0===r.code&&(e.userTagsList=r.memberTags)}).catch(function(){})},getChannels:function(){var e=this;l.a.activity.channels().then(function(t){var r=t.data;r&&0===r.code&&(e.channels=r.channelList,e.umpPlatCouponId||(e.ruleForm.channelList=r.channelList.map(function(e){return parseInt(e.id)})))}).catch(function(){})}}},u={render:function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{staticClass:"mod-create"},[r("div",{staticClass:"el-cardheader"},[r("span",[e._v(e._s(0!=e.umpPlatCouponId?"修改活动":"创建活动"))])]),e._v(" "),r("el-form",{ref:"ruleForm",staticClass:"coupon-ruleForm",attrs:{model:e.ruleForm,rules:e.rules,"label-width":"140px"}},[r("el-form-item",{attrs:{label:"优惠券名称",prop:"name"}},[r("el-input",{staticClass:"input_small",attrs:{disabled:!(e.status<4)},model:{value:e.ruleForm.name,callback:function(t){e.$set(e.ruleForm,"name",t)},expression:"ruleForm.name"}}),e._v(" "),r("span",{staticClass:"default_tips"},[e._v("优惠券名称不能为空，最多可输入30个字符，不能输入特殊符号")])],1),e._v(" "),r("div",{staticClass:"timeBox"},[e.ruleForm.dynamic?e._e():r("el-form-item",{attrs:{label:"开始时间",prop:"effectStartTime"}},[r("el-date-picker",{attrs:{readonly:!(e.status<2),type:"datetimerange","value-format":"timestamp","range-separator":"至","start-placeholder":"开始时间","end-placeholder":"结束时间"},model:{value:e.ruleForm.effectStartTime,callback:function(t){e.$set(e.ruleForm,"effectStartTime",t)},expression:"ruleForm.effectStartTime"}})],1),e._v(" "),e.ruleForm.dynamic?r("el-form-item",{staticClass:"is-required",attrs:{label:"获取后",prop:"actDaysLimit"}},[r("el-input",{staticClass:"input_default",attrs:{disabled:!(e.status<2)},model:{value:e.ruleForm.actDaysLimit,callback:function(t){e.$set(e.ruleForm,"actDaysLimit",t)},expression:"ruleForm.actDaysLimit"}}),e._v(" "),r("span",[e._v("天激活")])],1):e._e(),e._v(" "),e.ruleForm.dynamic?r("el-form-item",{staticClass:"is-required",attrs:{label:"激活后",prop:"validDaysLimit"}},[r("el-input",{staticClass:"input_default",attrs:{disabled:!(e.status<2)},model:{value:e.ruleForm.validDaysLimit,callback:function(t){e.$set(e.ruleForm,"validDaysLimit",t)},expression:"ruleForm.validDaysLimit"}}),e._v(" "),r("span",[e._v("天内有效")])],1):e._e(),e._v(" "),r("el-checkbox",{staticClass:"time_s",attrs:{disabled:!(e.status<2)},model:{value:e.ruleForm.dynamic,callback:function(t){e.$set(e.ruleForm,"dynamic",t)},expression:"ruleForm.dynamic"}},[e._v("动态配置")])],1),e._v(" "),r("el-form-item",{attrs:{label:"发行数",prop:"maxNum"}},[r("el-input",{staticClass:"input_default",attrs:{disabled:!(e.status<4),maxlength:"6"},model:{value:e.ruleForm.maxNum,callback:function(t){e.$set(e.ruleForm,"maxNum",e._n(t))},expression:"ruleForm.maxNum"}}),e._v(" "),r("span",{staticClass:"default_tips"},[e._v("最多发行10万份")])],1),e._v(" "),r("el-form-item",{attrs:{label:"用户最多拥有数量",prop:"limitNum"}},[r("el-input",{staticClass:"input_default",attrs:{disabled:!(e.status<4)},model:{value:e.ruleForm.limitNum,callback:function(t){e.$set(e.ruleForm,"limitNum",e._n(t))},expression:"ruleForm.limitNum"}})],1),e._v(" "),r("el-form-item",{staticClass:"mb_0",attrs:{label:"优惠券可领取"}},[r("el-checkbox",{attrs:{disabled:!(e.status<4)},model:{value:e.ruleForm.obtained,callback:function(t){e.$set(e.ruleForm,"obtained",t)},expression:"ruleForm.obtained"}},[e._v("可领取")])],1),e._v(" "),e.ruleForm.obtained?r("el-form-item",{staticClass:"is-required",attrs:{label:"领取时间",prop:"obtainStartTime"}},[r("el-date-picker",{attrs:{readonly:!(e.status<4),type:"datetimerange","value-format":"timestamp","range-separator":"至","start-placeholder":"开始时间","end-placeholder":"结束时间"},model:{value:e.ruleForm.obtainStartTime,callback:function(t){e.$set(e.ruleForm,"obtainStartTime",t)},expression:"ruleForm.obtainStartTime"}})],1):e._e(),e._v(" "),r("el-form-item",{attrs:{label:"使用条件",prop:"conAmount"}},[e._v("\n      同一笔订单中，指定商品金额满\n      "),r("el-input",{staticClass:"input_mini ml_5 mr_5",attrs:{disabled:!(e.status<2)},model:{value:e.ruleForm.conAmount,callback:function(t){e.$set(e.ruleForm,"conAmount",e._n(t))},expression:"ruleForm.conAmount"}}),e._v("元可用\n    ")],1),e._v(" "),r("el-form-item",{staticClass:"mb_0 is-required",attrs:{label:"优惠金额"}},[r("el-radio-group",{attrs:{disabled:!(e.status<2)},model:{value:e.ruleForm.type,callback:function(t){e.$set(e.ruleForm,"type",t)},expression:"ruleForm.type"}},[r("el-radio",{attrs:{label:1}},[e._v("订单减固定价格购买")]),e._v(" "),r("el-radio",{attrs:{label:2}},[e._v("订单减固定折扣购买")])],1)],1),e._v(" "),"1"==e.ruleForm.type?r("el-form-item",{staticClass:"mb_5",attrs:{prop:"amount",label:""}},[e._v("\n      订单价格优惠\n      "),r("el-input",{staticClass:"input_mini ml_5 mr_5",attrs:{disabled:!(e.status<2)},model:{value:e.ruleForm.amount,callback:function(t){e.$set(e.ruleForm,"amount",e._n(t))},expression:"ruleForm.amount"}}),e._v("元\n    ")],1):e._e(),e._v(" "),"2"==e.ruleForm.type?r("el-form-item",{attrs:{prop:"discount",label:""}},[e._v("\n      订单价格乘以\n      "),r("el-input",{staticClass:"input_mini ml_5 mr_5",attrs:{disabled:!(e.status<2)},model:{value:e.ruleForm.discount,callback:function(t){e.$set(e.ruleForm,"discount",e._n(t))},expression:"ruleForm.discount"}}),e._v("%折扣出售\n    ")],1):e._e(),e._v(" "),r("el-form-item",{staticClass:"mb_0 is-required",attrs:{label:"会员等级"}},[r("el-radio-group",{attrs:{disabled:!(e.status<4)},model:{value:e.ruleForm.userLevelType,callback:function(t){e.$set(e.ruleForm,"userLevelType",t)},expression:"ruleForm.userLevelType"}},[r("el-radio",{attrs:{label:1}},[e._v("会员等级")]),e._v(" "),r("el-radio",{attrs:{label:2}},[e._v("会员标签")])],1),e._v("\n      会员等级"+e._s(e.ruleForm.userGradeList)+" 会员标签"+e._s(e.ruleForm.userTagsList)+"\n    ")],1),e._v(" "),"1"==e.ruleForm.userLevelType?r("el-form-item",{staticClass:"mb_10",attrs:{label:"",prop:"userGradeList"}},[r("div",{staticClass:"userBox"},[r("el-checkbox-group",{attrs:{disabled:!(e.status<4)},model:{value:e.ruleForm.userGradeList,callback:function(t){e.$set(e.ruleForm,"userGradeList",t)},expression:"ruleForm.userGradeList"}},e._l(e.userGradeList,function(t){return r("div",{key:t.id,staticClass:"user_check"},[r("el-checkbox",{attrs:{label:parseInt(t.id)}},[e._v(e._s(t.name))])],1)}))],1)]):r("el-form-item",{staticClass:"mb_10",attrs:{label:"",prop:"userTagsList"}},[r("div",{staticClass:"userBox"},[r("el-checkbox-group",{attrs:{disabled:!(e.status<4)},model:{value:e.ruleForm.userTagsList,callback:function(t){e.$set(e.ruleForm,"userTagsList",t)},expression:"ruleForm.userTagsList"}},e._l(e.userTagsList,function(t){return r("div",{key:t.id,staticClass:"user_check"},[r("el-checkbox",{attrs:{label:parseInt(t.id)}},[e._v(e._s(t.name))])],1)}))],1)]),e._v(" "),r("el-form-item",{staticClass:"mb_0",attrs:{label:"优惠券类型",prop:"reused"}},[r("el-radio",{attrs:{disabled:!(e.status<4),label:!1},model:{value:e.ruleForm.reused,callback:function(t){e.$set(e.ruleForm,"reused",t)},expression:"ruleForm.reused"}},[e._v("优惠券(同一张优惠券仅可使用一次)")])],1),e._v(" "),r("el-form-item",{staticClass:"mb_0",attrs:{label:"限制手机用户使用",prop:"phoneLimited"}},[r("el-radio-group",{attrs:{disabled:!(e.status<4)},model:{value:e.ruleForm.phoneLimited,callback:function(t){e.$set(e.ruleForm,"phoneLimited",t)},expression:"ruleForm.phoneLimited"}},[r("el-radio",{attrs:{label:!0}},[e._v("是")]),e._v(" "),r("el-radio",{attrs:{label:!1}},[e._v("否")])],1)],1),e._v(" "),r("el-form-item",{staticClass:"mb_0",attrs:{label:"限制用户首单使用",prop:"firstOrderType",disabled:!(e.status<4)}},[r("el-radio-group",{model:{value:e.ruleForm.firstOrderType,callback:function(t){e.$set(e.ruleForm,"firstOrderType",t)},expression:"ruleForm.firstOrderType"}},[r("el-radio",{attrs:{label:1}},[e._v("限制店铺首单")]),e._v(" "),r("el-radio",{attrs:{label:2}},[e._v("限制平台首单")]),e._v(" "),r("el-radio",{attrs:{label:0}},[e._v("否")])],1)],1),e._v(" "),r("el-form-item",{staticClass:"mb_0",attrs:{label:"限制设备首单使用",prop:"firstDeviceLimited"}},[r("el-radio-group",{attrs:{disabled:!(e.status<4)},model:{value:e.ruleForm.firstDeviceLimited,callback:function(t){e.$set(e.ruleForm,"firstDeviceLimited",t)},expression:"ruleForm.firstDeviceLimited"}},[r("el-radio",{attrs:{label:!0}},[e._v("是")]),e._v(" "),r("el-radio",{attrs:{label:!1}},[e._v("否")])],1)],1),e._v(" "),r("el-form-item",{staticClass:"mb_0",attrs:{label:"可使用活动渠道"}},[r("el-checkbox-group",{attrs:{disabled:!(e.status<4)},model:{value:e.ruleForm.channelList,callback:function(t){e.$set(e.ruleForm,"channelList",t)},expression:"ruleForm.channelList"}},e._l(e.channels,function(t){return r("el-checkbox",{key:t.id,attrs:{label:parseInt(t.id)}},[e._v(e._s(t.name))])}))],1),e._v(" "),r("el-form-item",{staticClass:"mb_5",attrs:{label:"提报类型",prop:"reportType"}},[r("el-radio-group",{attrs:{disabled:!(e.status<2)},model:{value:e.ruleForm.reportType,callback:function(t){e.$set(e.ruleForm,"reportType",t)},expression:"ruleForm.reportType"}},[r("el-radio",{attrs:{label:0}},[e._v("全场")]),e._v(" "),r("el-radio",{attrs:{label:1}},[e._v("通过产品添加")])],1)],1),e._v(" "),r("el-form-item",{attrs:{label:"发券方"}},[r("el-input",{staticClass:"input_small",attrs:{disabled:!(e.status<4)},model:{value:e.ruleForm.couponDepartment,callback:function(t){e.$set(e.ruleForm,"couponDepartment",t)},expression:"ruleForm.couponDepartment"}})],1),e._v(" "),r("el-form-item",{attrs:{label:"优惠券号前缀"}},[r("el-input",{staticClass:"input_small",attrs:{disabled:!(e.status<4)},model:{value:e.ruleForm.prefix,callback:function(t){e.$set(e.ruleForm,"prefix",t)},expression:"ruleForm.prefix"}})],1),e._v(" "),r("el-form-item",{attrs:{label:"备注"}},[r("el-input",{staticClass:"textarea_default",attrs:{disabled:!(e.status<4),type:"textarea"},model:{value:e.ruleForm.remark,callback:function(t){e.$set(e.ruleForm,"remark",t)},expression:"ruleForm.remark"}})],1),e._v(" "),r("el-form-item",{attrs:{label:"优惠券规则描述"}},[r("el-input",{staticClass:"textarea_default",attrs:{disabled:!(e.status<4),type:"textarea"},model:{value:e.ruleForm.info,callback:function(t){e.$set(e.ruleForm,"info",t)},expression:"ruleForm.info"}})],1),e._v(" "),r("el-form-item",{staticClass:"form-btn-op"},[r("el-button",{attrs:{type:"primary"},on:{click:function(t){e.submitForm("ruleForm")}}},[e._v("完成")]),e._v(" "),e.umpPlatCouponId?e._e():r("el-button",{on:{click:function(t){e.resetForm("ruleForm")}}},[e._v("重置")]),e._v(" "),r("router-link",{staticClass:"el-button el-button--default",attrs:{to:{name:"ActivityCreate"}}},[e._v("返回")])],1)],1)],1)},staticRenderFns:[]};var n=r("VU/8")(o,u,!1,function(e){r("B411")},null,null);t.default=n.exports}});